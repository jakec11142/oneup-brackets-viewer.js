<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../dist/brackets-viewer.min.css" />
    <script type="text/javascript" src="../dist/brackets-viewer.min.js"></script>
    <title>Bracket Showcase</title>
    <link rel="stylesheet" href="themes/light.css" />
    <style>
        body {
            font-family: sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        select, button {
            padding: 6px 8px;
            font-size: 14px;
            margin-right: 8px;
        }

        #controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        #showcase-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        #showcase-list button {
            min-width: 180px;
        }

        #viewer-root {
            margin-top: 20px;
            background: #fff;
            border-radius: 6px;
            padding: 16px;
            box-shadow: 0 0 12px rgba(0,0,0,0.08);
        }
    </style>
</head>
<body>
    <div id="controls">
        <label>
            Format:
            <select id="format-select">
                <option value="roundRobin">Round Robin</option>
                <option value="swiss" selected>Swiss</option>
                <option value="singleElimination">Single Elimination</option>
                <option value="doubleElimination">Double Elimination</option>
            </select>
        </label>
        <button id="render-all">Render All Samples</button>
    </div>

    <div id="showcase-list"></div>

    <div id="viewer-root" class="brackets-viewer"></div>

    <script type="module">
        const DATA_URL = './showcase-data.json';
        const showcaseRoot = document.getElementById('viewer-root');
        const listContainer = document.getElementById('showcase-list');
        const formatSelect = document.getElementById('format-select');
        const renderAllBtn = document.getElementById('render-all');

        const showcaseData = await fetch(DATA_URL)
            .then(res => res.json())
            .catch(() => {
                alert('Unable to load showcase data.');
                return {};
            });

        formatSelect.addEventListener('change', () => populateSamples(formatSelect.value));
        renderAllBtn.addEventListener('click', () => renderSamples(formatSelect.value, true));

        populateSamples(formatSelect.value);

        function populateSamples(format) {
            listContainer.innerHTML = '';
            const samples = showcaseData[format] || [];

            samples.forEach((sample, index) => {
                const btn = document.createElement('button');
                btn.textContent = `${index + 1}. ${sample.label}`;
                btn.addEventListener('click', () => renderSample(format, sample));
                listContainer.appendChild(btn);
            });

            if (samples.length > 0)
                renderSample(format, samples[0]);
        }

        function renderSamples(format, renderAll = false) {
            const samples = showcaseData[format] || [];
            if (!samples.length) return;

            if (!renderAll)
                return renderSample(format, samples[0]);

            showcaseRoot.innerHTML = '';

            samples.forEach((sample, index) => {
                const wrapper = document.createElement('section');
                wrapper.style.marginBottom = '40px';

                const title = document.createElement('h2');
                title.textContent = `${index + 1}. ${sample.label}`;
                wrapper.appendChild(title);

                const container = document.createElement('div');
                container.classList.add('brackets-viewer');
                container.id = `showcase-${format}-${index}`;
                wrapper.appendChild(container);

                showcaseRoot.appendChild(wrapper);

                const viewerData = convertSample(sample, format);
                window.bracketsViewer.render(viewerData, { selector: `#${container.id}`, clear: true });
            });
        }

        function renderSample(format, sample) {
            const viewerData = convertSample(sample, format);
            window.bracketsViewer.render(viewerData, { selector: '#viewer-root', clear: true });
        }

        function convertSample(sample, format) {
            return window.bracketsViewerDTO.convertStageStructureToViewerData(sample.structure, sample.standings, {
                stageName: sample.label,
            });
        }
    </script>
</body>
</html>
